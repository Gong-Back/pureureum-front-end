import Head from 'next/head';
import { useEffect, useState } from 'react';

import { ProjectRepository } from '@/apis/project';
import HomeTemplate from '@/components/template/HomeTemplate';
import { CategoryType, ProjectResponses } from '@/constants/types';

// TODO 서버 사이드 애러 핸들링
// export const getServerSideProps = async () => {
//  try {
//    const [popRes, latRes] = await Promise.all([
//      ProjectRepository.getMainProjectListAsync('POPULAR'),
//      ProjectRepository.getMainProjectListAsync('LATEST'),
//    ]);
//    const data = {
//      popularProjects: popRes.data.projectList,
//      latestProjects: latRes.data.projectList,
//    };
//    return { props: data };
//  } catch (error) {
//    return { props: { ...(error as ApiError) } };
//  }
// };

const Home = () => {
  const [categoryFilter, setCategoryFilter] = useState<CategoryType>();
  const [popularProjects, setPopularProjects] = useState<
    Array<ProjectResponses['main']>
  >([]);
  const [latestProjects, setLatestProjects] = useState<
    Array<ProjectResponses['main']>
  >([]);

  useEffect(() => {
    const getMainData = async () => {
      const [popRes, latRes] = await Promise.all([
        ProjectRepository.getMainProjectListAsync('POPULAR', categoryFilter),
        ProjectRepository.getMainProjectListAsync('LATEST', categoryFilter),
      ]);
      setPopularProjects(popRes.data.projectList);
      setLatestProjects(latRes.data.projectList);
    };
    getMainData();
  }, [categoryFilter]);

  const onClickCategoryFilter = (c: CategoryType) => {
    setCategoryFilter(c === categoryFilter ? undefined : c);
  };

  return (
    <>
      <Head>
        <title>안녕, 푸르름</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      {popularProjects && latestProjects && (
        <HomeTemplate
          popularProjects={popularProjects}
          newProjects={latestProjects}
          categoryFilter={categoryFilter}
          onClickCategoryFilter={onClickCategoryFilter}
        />
      )}
    </>
  );
};
export default Home;
